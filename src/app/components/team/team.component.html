<!-- Redesigned Team Management Page -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-slate-100 to-gray-200 py-6 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    
    <!-- Page Header -->
    <div class="mb-8">
      <div class="flex items-center gap-4 mb-2">
        <div class="w-12 h-12 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
          <mat-icon class="!text-3xl text-white">groups</mat-icon>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Team Management</h1>
          <p class="text-gray-600 text-sm mt-1">Manage your team members and their roles</p>
        </div>
      </div>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-24 bg-white rounded-2xl shadow-sm">
      <div class="relative mb-6">
        <mat-spinner diameter="60"></mat-spinner>
      </div>
      <p class="text-gray-700 font-semibold text-lg">Loading team members...</p>
      <p class="text-gray-500 text-sm mt-1">Please wait</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="bg-white rounded-2xl shadow-sm p-12">
      <div class="text-center max-w-md mx-auto">
        <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <mat-icon class="!text-5xl text-red-600">error_outline</mat-icon>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-3">Error Loading Team</h3>
        <p class="text-red-600 mb-6 bg-red-50 px-4 py-3 rounded-lg border border-red-200">{{ error }}</p>
        <button 
          (click)="loadUsers()" 
          class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors shadow-md">
          <mat-icon class="!text-xl">refresh</mat-icon>
          <span>Retry</span>
        </button>
      </div>
    </div>

    <!-- No Users State -->
    <div *ngIf="!loading && !error && users.length === 0" class="bg-white rounded-2xl shadow-sm p-12">
      <div class="text-center max-w-md mx-auto">
        <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <mat-icon class="!text-6xl text-gray-400">group_off</mat-icon>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-3">No Team Members</h3>
        <p class="text-gray-600">
          No users with TMIS email addresses are registered yet.
        </p>
      </div>
    </div>

    <!-- Team Grid View -->
    <div *ngIf="!loading && !error && users.length > 0">
      
      <!-- Stats Bar -->
      <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-200">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
              <mat-icon class="!text-2xl text-indigo-600">people</mat-icon>
            </div>
            <div>
              <p class="text-sm text-gray-600 font-medium">Total Members</p>
              <p class="text-2xl font-bold text-gray-900">{{ users.length }}</p>
            </div>
          </div>
          <div class="flex items-center gap-2 px-4 py-2 bg-indigo-50 rounded-lg">
            <mat-icon class="!text-xl text-indigo-600">verified</mat-icon>
            <span class="text-sm font-semibold text-indigo-700">TMIS Team</span>
          </div>
        </div>
      </div>

      <!-- Team Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div *ngFor="let user of users; let i = index" 
             class="group bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 hover:border-indigo-300">
          
          <!-- Card Header with Gradient -->
          <div class="h-24 bg-gradient-to-br relative overflow-hidden"
               [ngClass]="{
                 'from-purple-500 to-pink-500': user.role === 'admin',
                 'from-blue-500 to-indigo-500': user.role === 'user',
                 'from-green-500 to-emerald-500': user.role === 'manager'
               }">
            <div class="absolute inset-0 bg-black/10"></div>
            
            <!-- Role Badge in Header -->
            <div class="absolute top-3 right-3">
              <span class="inline-flex items-center gap-1 px-3 py-1 bg-white/20 backdrop-blur-sm text-white rounded-lg text-xs font-bold uppercase">
                <mat-icon class="!text-sm">
                  {{ user.role === 'admin' ? 'admin_panel_settings' : user.role === 'manager' ? 'manage_accounts' : 'person' }}
                </mat-icon>
                {{ user.role }}
              </span>
            </div>
            
            <!-- Serial Number -->
            <div class="absolute top-3 left-3">
              <div class="w-8 h-8 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
                <span class="text-xs font-bold text-white">{{ i + 1 }}</span>
              </div>
            </div>
          </div>
          
          <!-- Card Body -->
          <div class="p-6 relative">
            
            <!-- Avatar -->
            <div class="absolute -top-10 left-6">
              <div class="relative">
                <div class="w-20 h-20 bg-gradient-to-br rounded-2xl flex items-center justify-center shadow-lg border-4 border-white"
                     [ngClass]="{
                       'from-purple-500 to-pink-500': user.role === 'admin',
                       'from-blue-500 to-indigo-500': user.role === 'user',
                       'from-green-500 to-emerald-500': user.role === 'manager'
                     }">
                  <mat-icon class="!text-4xl text-white">account_circle</mat-icon>
                </div>
                <!-- Status Indicator -->
                <div class="absolute bottom-1 right-1 w-5 h-5 rounded-full border-4 border-white shadow-md"
                     [ngClass]="{
                       'bg-green-500': user.status !== 'paused',
                       'bg-red-500': user.status === 'paused'
                     }"></div>
              </div>
            </div>
            
            <!-- User Info -->
            <div class="mt-12">
              <h3 class="text-xl font-bold text-gray-900 mb-1 truncate">
                {{ user.username }}
              </h3>
              <p class="text-sm text-gray-600 truncate flex items-center gap-1 mb-4">
                <mat-icon class="!text-base text-gray-400">email</mat-icon>
                {{ user.email }}
              </p>
              
              <!-- Status Badge -->
              <div *ngIf="user.status === 'paused'" class="mb-4">
                <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-xs font-bold uppercase">
                  <mat-icon class="!text-sm">pause_circle</mat-icon>
                  Paused
                </span>
              </div>
              
              <!-- Join Date -->
              <div class="flex items-center gap-2 text-xs text-gray-500 mb-4 pb-4 border-b border-gray-100">
                <mat-icon class="!text-base text-indigo-500">event</mat-icon>
                <span>Joined {{ user.created_at | date:'mediumDate' }}</span>
              </div>
              
              <!-- Action Buttons -->
              <div *ngIf="isAdmin && user.role !== 'admin' && user._id !== currentUser?.id" 
                   class="flex items-center gap-2">
                
                <!-- Pause/Resume Button -->
                <button *ngIf="user.status !== 'paused'" 
                        (click)="pauseUser(user)" 
                        class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-orange-50 text-orange-600 rounded-lg hover:bg-orange-100 transition-colors font-semibold text-sm">
                  <mat-icon class="!text-lg">pause_circle</mat-icon>
                  <span>Pause</span>
                </button>
                
                <button *ngIf="user.status === 'paused'" 
                        (click)="resumeUser(user)" 
                        class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition-colors font-semibold text-sm">
                  <mat-icon class="!text-lg">play_circle</mat-icon>
                  <span>Resume</span>
                </button>
                
                <!-- Delete Button -->
                <button 
                        (click)="deleteUser(user)" 
                        class="px-4 py-2.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors">
                  <mat-icon class="!text-lg">delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="mt-8 text-center">
        <p class="text-sm text-gray-600">
          Showing all team members with TMIS email addresses
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Delete User Confirmation Modal -->
<div *ngIf="showDeleteDialog" class="confirmation-modal-overlay" (click)="cancelDelete()">
  <div class="confirmation-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-icon delete-icon">
      <mat-icon>delete_forever</mat-icon>
    </div>
    <h2>Delete User</h2>
    <div class="user-name-display">
      <mat-icon>person</mat-icon>
      <span>{{ selectedUser?.username }}</span>
    </div>
    <p class="warning-message">Are you sure you want to delete this user?</p>
    <div class="warning-list">
      <div class="warning-item">
        <mat-icon>close</mat-icon>
        <span>User will be permanently removed from the system</span>
      </div>
      <div class="warning-item">
        <mat-icon>close</mat-icon>
        <span>This action cannot be undone</span>
      </div>
    </div>
    <div class="modal-actions">
      <button class="cancel-button" (click)="cancelDelete()" [disabled]="isDeleting">Cancel</button>
      <button class="delete-button" (click)="confirmDelete()" [disabled]="isDeleting">
        <mat-spinner *ngIf="isDeleting" diameter="18"></mat-spinner>
        <mat-icon *ngIf="!isDeleting">delete_forever</mat-icon>
        <span>{{ isDeleting ? 'Deleting...' : 'Delete' }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Pause User Confirmation Modal -->
<div *ngIf="showPauseDialog" class="confirmation-modal-overlay" (click)="cancelPause()">
  <div class="confirmation-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-icon pause-icon">
      <mat-icon>pause_circle</mat-icon>
    </div>
    <h2>Pause User</h2>
    <div class="user-name-display">
      <mat-icon>person</mat-icon>
      <span>{{ selectedUser?.username }}</span>
    </div>
    <p class="warning-message">Are you sure you want to pause this user?</p>
    <div class="info-list">
      <div class="info-item">
        <mat-icon>info</mat-icon>
        <span>User will not appear in staff selection dropdowns</span>
      </div>
      <div class="info-item">
        <mat-icon>info</mat-icon>
        <span>You can resume the user at any time</span>
      </div>
    </div>
    <div class="modal-actions">
      <button class="cancel-button" (click)="cancelPause()" [disabled]="isPausing">Cancel</button>
      <button class="pause-button" (click)="confirmPause()" [disabled]="isPausing">
        <mat-spinner *ngIf="isPausing" diameter="18"></mat-spinner>
        <mat-icon *ngIf="!isPausing">pause_circle</mat-icon>
        <span>{{ isPausing ? 'Pausing...' : 'Pause' }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Resume User Confirmation Modal -->
<div *ngIf="showResumeDialog" class="confirmation-modal-overlay" (click)="cancelResume()">
  <div class="confirmation-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-icon resume-icon">
      <mat-icon>play_circle</mat-icon>
    </div>
    <h2>Resume User</h2>
    <div class="user-name-display">
      <mat-icon>person</mat-icon>
      <span>{{ selectedUser?.username }}</span>
    </div>
    <p class="warning-message">Are you sure you want to resume this user?</p>
    <div class="info-list">
      <div class="info-item">
        <mat-icon>check_circle</mat-icon>
        <span>User will appear in staff selection dropdowns again</span>
      </div>
      <div class="info-item">
        <mat-icon>check_circle</mat-icon>
        <span>User will be active in the system</span>
      </div>
    </div>
    <div class="modal-actions">
      <button class="cancel-button" (click)="cancelResume()" [disabled]="isResuming">Cancel</button>
      <button class="resume-button" (click)="confirmResume()" [disabled]="isResuming">
        <mat-spinner *ngIf="isResuming" diameter="18"></mat-spinner>
        <mat-icon *ngIf="!isResuming">play_circle</mat-icon>
        <span>{{ isResuming ? 'Resuming...' : 'Resume' }}</span>
      </button>
    </div>
  </div>
</div>
