<!-- Main Container with Modern Gradient Background -->
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">

  <!-- Loading State -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center min-h-[60vh]">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mb-4"></div>
    <p class="text-gray-600 text-lg">Loading client details...</p>
  </div>

  <!-- Form Container -->
  <div *ngIf="!loading && client && clientForm" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Stepper Container -->
    <div class="backdrop-blur-xl bg-white/90 rounded-2xl shadow-xl border border-white/20 overflow-hidden mb-6">
      <div class="p-6">
        <!-- Stepper Header -->
        <div class="flex items-center justify-between mb-8 overflow-x-auto pb-4">
          <div *ngFor="let step of steps; let i = index" class="flex items-center" [class.flex-1]="i < steps.length - 1">
            <!-- Step Circle -->
            <div class="flex flex-col items-center relative cursor-pointer" (click)="goToStep(i)">
              <div class="w-12 h-12 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300 hover:scale-110"
                   [ngClass]="{
                     'bg-blue-600 text-white shadow-lg': i === currentStep,
                     'bg-green-500 text-white': step.completed && i < currentStep,
                     'bg-gray-200 text-gray-500 hover:bg-gray-300': i > currentStep
                   }">
                <mat-icon *ngIf="step.completed && i < currentStep" class="text-lg">check</mat-icon>
                <span *ngIf="!step.completed || i >= currentStep">{{ i + 1 }}</span>
              </div>
              <div class="mt-2 text-center min-w-[80px]">
                <div class="text-xs font-semibold" [ngClass]="{
                  'text-blue-600': i === currentStep,
                  'text-green-600': step.completed && i < currentStep,
                  'text-gray-500': i > currentStep
                }">{{ step.title }}</div>
                <div class="text-[10px] text-gray-500 mt-0.5 hidden sm:block">{{ step.description }}</div>
              </div>
            </div>
            <!-- Connector Line -->
            <div *ngIf="i < steps.length - 1" class="flex-1 h-0.5 mx-2 transition-all duration-300"
                 [ngClass]="{
                   'bg-green-500': i < currentStep,
                   'bg-blue-600': i === currentStep,
                   'bg-gray-200': i >= currentStep
                 }"></div>
          </div>
        </div>

        <!-- Current Step Info -->
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800 flex items-center justify-center gap-2">
            <mat-icon class="text-blue-600">{{ steps[currentStep].icon }}</mat-icon>
            {{ steps[currentStep].title }}
          </h2>
          <p class="text-gray-600 mt-1">{{ steps[currentStep].description }}</p>
        </div>
      </div>
    </div>

    <form [formGroup]="clientForm" class="space-y-6">
      <!-- Step 0: Personal Information Section -->
      <div *ngIf="currentStep === 0">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Personal Information</h3>
              <p class="text-sm text-gray-600">Basic business and contact details</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Legal Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Legal Name *</label>
              <input type="text" 
                     formControlName="legal_name"
                     placeholder="Enter legal name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Trade Name/Business Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Trade Name/Business Name</label>
              <input type="text" 
                     formControlName="trade_name"
                     placeholder="Enter trade or business name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- User Email/Company Email -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">User Email/Company Email (Optional)</label>
              <input type="email" 
                     formControlName="user_email"
                     placeholder="Enter email address"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('user_email')?.hasError('email') && clientForm.get('user_email')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('user_email')?.hasError('email') && clientForm.get('user_email')?.touched">
              <div *ngIf="clientForm.get('user_email')?.hasError('email') && clientForm.get('user_email')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid email
              </div>
            </div>

            <!-- Company Email -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Company Email (Optional)</label>
              <input type="email" 
                     formControlName="company_email"
                     placeholder="Enter company email"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('company_email')?.hasError('email') && clientForm.get('company_email')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('company_email')?.hasError('email') && clientForm.get('company_email')?.touched">
              <div *ngIf="clientForm.get('company_email')?.hasError('email') && clientForm.get('company_email')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid email
              </div>
            </div>

            <!-- Mobile Number -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number *</label>
              <input type="tel" 
                     formControlName="mobile_number"
                     placeholder="Enter 10-digit mobile number"
                     maxlength="10"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('mobile_number')?.hasError('pattern') && clientForm.get('mobile_number')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('mobile_number')?.hasError('pattern') && clientForm.get('mobile_number')?.touched">
              <div *ngIf="clientForm.get('mobile_number')?.hasError('pattern') && clientForm.get('mobile_number')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid 10-digit mobile number
              </div>
            </div>

            <!-- Optional Mobile Number -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Optional Mobile Number</label>
              <input type="tel" 
                     formControlName="optional_mobile_number"
                     placeholder="Enter 10-digit mobile number"
                     maxlength="10"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('optional_mobile_number')?.hasError('pattern') && clientForm.get('optional_mobile_number')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('optional_mobile_number')?.hasError('pattern') && clientForm.get('optional_mobile_number')?.touched">
              <div *ngIf="clientForm.get('optional_mobile_number')?.hasError('pattern') && clientForm.get('optional_mobile_number')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid 10-digit mobile number
              </div>
            </div>

            <!-- Website URL -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Website URL (Optional)</label>
              <input type="url" 
                     formControlName="website"
                     placeholder="https://example.com"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('website')?.hasError('pattern') && clientForm.get('website')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('website')?.hasError('pattern') && clientForm.get('website')?.touched">
              <div *ngIf="clientForm.get('website')?.hasError('pattern') && clientForm.get('website')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid URL (e.g., https://example.com)
              </div>
            </div>
          </div>

          <!-- Address Information (Merged into Personal Info) -->
          <div class="mt-8 pt-8 border-t border-gray-200">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                <mat-icon class="text-orange-600 text-lg">location_on</mat-icon>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-800">Address Information</h4>
                <p class="text-sm text-gray-600">Business location and contact address</p>
              </div>
            </div>

            <div class="space-y-6">
              <!-- Complete Address -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">Complete Address *</label>
                <textarea formControlName="address" 
                          rows="3"
                          placeholder="Enter complete business address"
                          class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:border-gray-400 transition-colors resize-none shadow-sm"></textarea>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- District -->
                <div class="w-full">
                  <label class="block text-sm font-medium text-gray-700 mb-2">District</label>
                  <input type="text" 
                         formControlName="district"
                         placeholder="Enter district"
                         class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:border-gray-400 transition-colors shadow-sm">
                </div>

                <!-- State -->
                <div class="w-full">
                  <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                  <input type="text" 
                         formControlName="state"
                         placeholder="Enter state"
                         class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:border-gray-400 transition-colors shadow-sm">
                </div>

                <!-- Pincode -->
                <div class="w-full">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Pincode</label>
                  <input type="text" 
                         formControlName="pincode"
                         placeholder="Enter 6-digit pincode"
                         maxlength="6"
                         class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:border-gray-400 transition-colors shadow-sm"
                         [class.border-red-500]="clientForm.get('pincode')?.hasError('pattern') && clientForm.get('pincode')?.touched"
                         [class.focus:ring-red-500]="clientForm.get('pincode')?.hasError('pattern') && clientForm.get('pincode')?.touched">
                  <div *ngIf="clientForm.get('pincode')?.hasError('pattern') && clientForm.get('pincode')?.touched" class="mt-1 text-sm text-red-600">
                    Please enter a valid 6-digit pincode
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 1: GST Details Section -->
      <div *ngIf="currentStep === 1">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-green-600 text-lg">receipt</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">GST Details</h3>
              <p class="text-sm text-gray-600">GST registration and tax information</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- GST Status -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">GST Status</label>
              <input type="text" 
                     formControlName="gst_status"
                     placeholder="Enter GST status"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- GST Number -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">GST Number</label>
              <input type="text" 
                     formControlName="gst_number"
                     placeholder="Enter GST number"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- GST Registration Number -->
            <div class="w-full md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">GST Registration Number</label>
              <input type="text" 
                     formControlName="registration_number"
                     placeholder="Enter GST registration number"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

          </div>

          <!-- Document Uploads -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">GST Document</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['gst_document']}">
                <input type="file" (change)="onFileSelected($event, 'gst_document')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="gst_document">
                <label for="gst_document" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['gst_document'], 'text-gray-400': !documents['gst_document']}">{{ documents['gst_document'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['gst_document']">Upload GST Document (PDF, JPG, PNG)</p>
                  <div *ngIf="documents['gst_document']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['gst_document'].name }}</span>
                    <button type="button" (click)="removeDocument('gst_document')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['gst_document']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['gst_document'].file_name }} 
                  ({{ formatFileSize(existingDocuments['gst_document'].file_size) }})
                </small>
                <button (click)="downloadDocument('gst_document')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
            
            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">MSME/Udyam Document</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['msme_document']}">
                <input type="file" (change)="onFileSelected($event, 'msme_document')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="msme_document">
                <label for="msme_document" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['msme_document'], 'text-gray-400': !documents['msme_document']}">{{ documents['msme_document'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['msme_document']">Upload MSME/Udyam Document</p>
                  <div *ngIf="documents['msme_document']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['msme_document'].name }}</span>
                    <button type="button" (click)="removeDocument('msme_document')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['msme_document']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['msme_document'].file_name }} 
                  ({{ formatFileSize(existingDocuments['msme_document'].file_size) }})
                </small>
                <button (click)="downloadDocument('msme_document')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 2: IE Code Details Section -->
      <div *ngIf="currentStep === 2">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-indigo-600 text-lg">qr_code</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">IE Code Details</h3>
              <p class="text-sm text-gray-600">Import Export Code information and documentation</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <!-- IE Code Number Field -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
              <span>IE Code Number</span>
              <span *ngIf="hasExistingDocument('ie_code') || hasExistingDocument('ie_code_document') || documents['ie_code_document']" 
                    class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Required</span>
              <span *ngIf="!hasExistingDocument('ie_code') && !hasExistingDocument('ie_code_document') && !documents['ie_code_document']" 
                    class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Optional</span>
            </label>
            <input type="text" 
                   formControlName="ie_code_number"
                   placeholder="Enter IE Code Number"
                   class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 hover:border-gray-400 transition-colors shadow-sm"
                   [class.border-red-500]="clientForm.get('ie_code_number')?.invalid && clientForm.get('ie_code_number')?.touched">
            <p *ngIf="clientForm.get('ie_code_number')?.invalid && clientForm.get('ie_code_number')?.touched" 
               class="text-xs text-red-600 mt-1">
              IE Code Number is required when IE document is uploaded
            </p>
          </div>

          <!-- IE Code Document Section - If document already exists -->
          <div *ngIf="hasExistingDocument('ie_code') || hasExistingDocument('ie_code_document')" class="ie-code-section mb-6">
            <h5 class="text-sm font-semibold text-gray-800 mb-3">Existing IE Code Document</h5>
            <div class="existing-document-display bg-gray-50 rounded-lg p-4 border border-gray-200">
              <div class="document-info flex items-center gap-3">
                <mat-icon class="text-indigo-600">description</mat-icon>
                <div class="flex-1">
                  <span class="text-sm font-medium text-gray-800">{{ getIECodeDocument()?.file_name || 'IE Code Document' }}</span>
                  <small *ngIf="getIECodeDocument()?.file_size" class="text-xs text-gray-500 block">({{ formatFileSize(getIECodeDocument().file_size) }})</small>
                </div>
              </div>
            </div>
            
            <h5 class="text-sm font-semibold text-gray-800 mb-3 mt-4">Update IE Code Document</h5>
            <p class="text-xs text-amber-600 mb-3">⚠️ Uploading a new document will reset the IE Code Number. Please enter the new IE Code Number above.</p>
            <div class="file-upload">
              <input type="file" id="ie_code_new" (change)="onFileSelected($event, 'ie_code_document')" accept=".pdf,.jpg,.jpeg,.png" class="hidden">
              <label for="ie_code_new" class="file-label cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors border border-indigo-200">
                <mat-icon>upload_file</mat-icon>
                Upload New IE Code Document
              </label>
              <div *ngIf="documents['ie_code_document']" class="file-info mt-3 flex items-center gap-2 bg-green-50 p-3 rounded-lg border border-green-200">
                <mat-icon class="text-green-600">check_circle</mat-icon>
                <small class="flex-1 text-sm text-green-800 font-medium">{{ documents['ie_code_document'].name }}</small>
                <button mat-icon-button color="warn" (click)="removeDocument('ie_code_document')" matTooltip="Remove" class="flex-shrink-0">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- IE Code Upload (if not already uploaded) -->
          <div *ngIf="!hasExistingDocument('ie_code') && !hasExistingDocument('ie_code_document')" class="ie-code-section">
            <h5 class="text-sm font-semibold text-gray-800 mb-3">IE Code Document Upload</h5>
            <p class="text-xs text-gray-600 mb-3">Upload IE Code document if available. IE Code Number will be required after upload.</p>
            <div class="file-upload">
              <input type="file" id="ie_code" (change)="onFileSelected($event, 'ie_code_document')" accept=".pdf,.jpg,.jpeg,.png" class="hidden">
              <label for="ie_code" class="file-label cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors border border-indigo-200">
                <mat-icon>upload_file</mat-icon>
                Upload IE Code Document
              </label>
              <div *ngIf="documents['ie_code_document']" class="file-info mt-3 flex items-center gap-2 bg-green-50 p-3 rounded-lg border border-green-200">
                <mat-icon class="text-green-600">check_circle</mat-icon>
                <small class="flex-1 text-sm text-green-800 font-medium">{{ documents['ie_code_document'].name }}</small>
                <button mat-icon-button color="warn" (click)="removeDocument('ie_code_document')" matTooltip="Remove" class="flex-shrink-0">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 3: Business Information Section -->
      <div *ngIf="currentStep === 3">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-blue-600 text-lg">business</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Business Information</h3>
              <p class="text-sm text-gray-600">Company structure and registration details</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Trade Name / Business Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Trade Name / Business Name</label>
              <input type="text" 
                     formControlName="trade_name"
                     placeholder="Enter trade or business name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Constitution of Business -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Constitution of Business</label>
              <div class="relative">
                <button type="button"
                        (click)="toggleConstitutionDropdown()"
                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm"
                        [class.border-blue-500]="isConstitutionDropdownOpen"
                        [class.ring-2]="isConstitutionDropdownOpen"
                        [class.ring-blue-500]="isConstitutionDropdownOpen">
                  <span class="block truncate text-gray-700">
                    {{ getConstitutionLabel(clientForm.get('constitution_type')?.value) }}
                  </span>
                  <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-400 transition-transform duration-200"
                         [class.rotate-180]="isConstitutionDropdownOpen"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </span>
                </button>
                
                <!-- Dropdown Options -->
                <div *ngIf="isConstitutionDropdownOpen"
                     class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                  <button type="button"
                          (click)="selectConstitution('Proprietorship')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-blue-50]="clientForm.get('constitution_type')?.value === 'Proprietorship'"
                          [class.text-blue-600]="clientForm.get('constitution_type')?.value === 'Proprietorship'">
                    Proprietorship
                  </button>
                  <button type="button"
                          (click)="selectConstitution('Partnership')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-blue-50]="clientForm.get('constitution_type')?.value === 'Partnership'"
                          [class.text-blue-600]="clientForm.get('constitution_type')?.value === 'Partnership'">
                    Partnership
                  </button>
                  <button type="button"
                          (click)="selectConstitution('Private Limited')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                          [class.bg-blue-50]="clientForm.get('constitution_type')?.value === 'Private Limited'"
                          [class.text-blue-600]="clientForm.get('constitution_type')?.value === 'Private Limited'">
                    Private Limited
                  </button>
                </div>
              </div>
            </div>

            <!-- Business PAN -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Business PAN</label>
              <div class="relative">
                <button type="button"
                        (click)="toggleBusinessPanDropdown()"
                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm"
                        [class.border-blue-500]="isBusinessPanDropdownOpen"
                        [class.ring-2]="isBusinessPanDropdownOpen"
                        [class.ring-blue-500]="isBusinessPanDropdownOpen">
                  <span class="block truncate text-gray-700">
                    {{ getBusinessPanLabel(clientForm.get('has_business_pan')?.value) }}
                  </span>
                  <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-400 transition-transform duration-200"
                         [class.rotate-180]="isBusinessPanDropdownOpen"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </span>
                </button>
                
                <!-- Dropdown Options -->
                <div *ngIf="isBusinessPanDropdownOpen"
                     class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                  <button type="button"
                          (click)="selectBusinessPan('yes')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-blue-50]="clientForm.get('has_business_pan')?.value === 'yes'"
                          [class.text-blue-600]="clientForm.get('has_business_pan')?.value === 'yes'">
                    Yes
                  </button>
                  <button type="button"
                          (click)="selectBusinessPan('no')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                          [class.bg-blue-50]="clientForm.get('has_business_pan')?.value === 'no'"
                          [class.text-blue-600]="clientForm.get('has_business_pan')?.value === 'no'">
                    No
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Business Document Upload Section -->
          <div class="mt-6 pt-6 border-t border-gray-200">
            <div class="mb-4">
              <h4 class="text-base font-semibold text-gray-800 mb-2">Business Document</h4>
              <p class="text-sm text-gray-600">Upload business registration certificate, incorporation certificate, or other business documents</p>
            </div>
            
            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">Business Document</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['business_document']}">
                <input type="file" (change)="onFileSelected($event, 'business_document')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="business_document">
                <label for="business_document" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['business_document'], 'text-gray-400': !documents['business_document']}">{{ documents['business_document'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['business_document']">Upload Business Document (PDF, JPG, PNG)</p>
                  <div *ngIf="documents['business_document']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['business_document'].name }}</span>
                    <button type="button" (click)="removeDocument('business_document')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['business_document']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['business_document'].file_name }} 
                  ({{ formatFileSize(existingDocuments['business_document'].file_size) }})
                </small>
                <button (click)="downloadDocument('business_document')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Business PAN Details (Merged into Business) -->
          <div *ngIf="(clientForm.get('constitution_type')?.value === 'Proprietorship' || clientForm.get('constitution_type')?.value === 'Partnership' || clientForm.get('constitution_type')?.value === 'Private Limited') && (clientForm.get('has_business_pan')?.value === 'yes' || hasExistingDocument('business_pan_document'))" class="mt-8 pt-8 border-t border-gray-200">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center">
                <mat-icon class="text-indigo-600 text-lg">credit_card</mat-icon>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-800">Business PAN Details</h4>
                <p class="text-sm text-gray-600">Business PAN card information and documentation</p>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- Business PAN Name -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">Business PAN Name</label>
                <input type="text" 
                       formControlName="business_pan_name"
                       placeholder="Enter business PAN name"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>

              <!-- Business PAN Date -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">Business PAN Date</label>
                <input type="date" 
                       formControlName="business_pan_date"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>
            </div>

            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">Business PAN Document</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['business_pan_document']}">
                <input type="file" (change)="onFileSelected($event, 'business_pan_document')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="business_pan_document">
                <label for="business_pan_document" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['business_pan_document'], 'text-gray-400': !documents['business_pan_document']}">{{ documents['business_pan_document'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['business_pan_document']">Upload Business PAN Document (PDF, JPG, PNG)</p>
                  <div *ngIf="documents['business_pan_document']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['business_pan_document'].name }}</span>
                    <button type="button" (click)="removeDocument('business_pan_document')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['business_pan_document']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['business_pan_document'].file_name }} 
                  ({{ formatFileSize(existingDocuments['business_pan_document'].file_size) }})
                </small>
                <button (click)="downloadDocument('business_pan_document')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 4: Owner Details Section -->
      <div *ngIf="currentStep === 4 && (clientForm.get('constitution_type')?.value === 'Private Limited' || (clientForm.get('constitution_type')?.value === 'Proprietorship' && (clientForm.get('has_business_pan')?.value === 'yes' || hasExistingDocument('owner_aadhar') || hasExistingDocument('owner_pan'))))"
           class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-teal-600 text-lg">person_outline</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Owner Details</h3>
              <p class="text-sm text-gray-600">Owner information and documentation</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Owner Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Owner Name</label>
              <input type="text" 
                     formControlName="owner_name"
                     placeholder="Enter owner name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Owner Date of Birth -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Owner Date of Birth</label>
              <input type="date" 
                     formControlName="owner_dob"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">Owner Aadhar Card</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['owner_aadhar']}">
                <input type="file" (change)="onFileSelected($event, 'owner_aadhar')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="owner_aadhar">
                <label for="owner_aadhar" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['owner_aadhar'], 'text-gray-400': !documents['owner_aadhar']}">{{ documents['owner_aadhar'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['owner_aadhar']">Upload Owner Aadhar Card (PDF, JPG, PNG)</p>
                  <div *ngIf="documents['owner_aadhar']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['owner_aadhar'].name }}</span>
                    <button type="button" (click)="removeDocument('owner_aadhar')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['owner_aadhar']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['owner_aadhar'].file_name }} 
                  ({{ formatFileSize(existingDocuments['owner_aadhar'].file_size) }})
                </small>
                <button (click)="downloadDocument('owner_aadhar')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>

            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">Owner PAN Card</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['owner_pan']}">
                <input type="file" (change)="onFileSelected($event, 'owner_pan')" accept=".pdf,.jpg,.jpeg,.png" 
                       class="hidden" id="owner_pan">
                <label for="owner_pan" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['owner_pan'], 'text-gray-400': !documents['owner_pan']}">{{ documents['owner_pan'] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['owner_pan']">Upload Owner PAN Card (PDF, JPG, PNG)</p>
                  <div *ngIf="documents['owner_pan']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['owner_pan'].name }}</span>
                    <button type="button" (click)="removeDocument('owner_pan')" class="text-red-600 hover:text-red-800">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['owner_pan']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['owner_pan'].file_name }} 
                  ({{ formatFileSize(existingDocuments['owner_pan'].file_size) }})
                </small>
                <button (click)="downloadDocument('owner_pan')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Partnership Details (Merged into Owner Details) -->
          <div *ngIf="clientForm.get('constitution_type')?.value === 'Partnership'" class="mt-8 pt-8 border-t border-gray-200">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">
                <mat-icon class="text-amber-600 text-lg">group</mat-icon>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-800">Partnership Details</h4>
                <p class="text-sm text-gray-600">Partner information and documentation</p>
              </div>
            </div>

            <div class="mb-6">
              <!-- Number of Partners -->
              <div class="w-full md:w-1/2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Number of Partners</label>
                <input type="number" 
                       formControlName="number_of_partners"
                       min="2" 
                       max="10"
                       placeholder="Enter number of partners"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>
            </div>

            <div class="space-y-8">
              <div *ngFor="let i of getPartnerArray(); let idx = index" class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <h4 class="text-base font-semibold text-gray-800 mb-4">{{ idx === 0 ? 'Managing Partner' : 'Partner ' + (idx + 1) }}</h4>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <!-- Partner Name -->
                  <div class="w-full">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Partner Name</label>
                    <input type="text" 
                           [formControlName]="'partner_name_' + idx"
                           placeholder="Enter partner name"
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 hover:border-gray-400 transition-colors shadow-sm">
                  </div>

                  <!-- Partner Date of Birth -->
                  <div class="w-full">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Partner Date of Birth</label>
                    <input type="date" 
                           [formControlName]="'partner_dob_' + idx"
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 hover:border-gray-400 transition-colors shadow-sm">
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-3">
                    <label class="text-sm font-medium text-gray-800">Partner Aadhar Card</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                         [ngClass]="{'border-green-500 bg-green-50': documents['partner_aadhar_' + idx]}">
                      <input type="file" (change)="onFileSelected($event, 'partner_aadhar_' + idx)" accept=".pdf,.jpg,.jpeg,.png" 
                             class="hidden" [id]="'partner_aadhar_' + idx">
                      <label [for]="'partner_aadhar_' + idx" class="cursor-pointer">
                        <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['partner_aadhar_' + idx], 'text-gray-400': !documents['partner_aadhar_' + idx]}">{{ documents['partner_aadhar_' + idx] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                        <p class="text-sm" *ngIf="!documents['partner_aadhar_' + idx]">Upload Partner Aadhar Card (PDF, JPG, PNG)</p>
                        <div *ngIf="documents['partner_aadhar_' + idx]" class="flex items-center justify-between">
                          <span class="text-sm font-medium">{{ documents['partner_aadhar_' + idx].name }}</span>
                          <button type="button" (click)="removeDocument('partner_aadhar_' + idx)" class="text-red-600 hover:text-red-800">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </div>
                      </label>
                    </div>
                    <div *ngIf="getExistingPartnerDocument('aadhar', idx)" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                      <small class="text-blue-800">
                        {{ getExistingPartnerDocument('aadhar', idx).file_name }} 
                        ({{ formatFileSize(getExistingPartnerDocument('aadhar', idx).file_size) }})
                      </small>
                      <button (click)="downloadPartnerDocument('aadhar', idx)" class="text-blue-600 hover:text-blue-800">
                        <mat-icon>download</mat-icon>
                      </button>
                    </div>
                  </div>

                  <div class="space-y-3">
                    <label class="text-sm font-medium text-gray-800">Partner PAN Card</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                         [ngClass]="{'border-green-500 bg-green-50': documents['partner_pan_' + idx]}">
                      <input type="file" (change)="onFileSelected($event, 'partner_pan_' + idx)" accept=".pdf,.jpg,.jpeg,.png" 
                             class="hidden" [id]="'partner_pan_' + idx">
                      <label [for]="'partner_pan_' + idx" class="cursor-pointer">
                        <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['partner_pan_' + idx], 'text-gray-400': !documents['partner_pan_' + idx]}">{{ documents['partner_pan_' + idx] ? 'check_circle' : 'cloud_upload' }}</mat-icon>
                        <p class="text-sm" *ngIf="!documents['partner_pan_' + idx]">Upload Partner PAN Card (PDF, JPG, PNG)</p>
                        <div *ngIf="documents['partner_pan_' + idx]" class="flex items-center justify-between">
                          <span class="text-sm font-medium">{{ documents['partner_pan_' + idx].name }}</span>
                          <button type="button" (click)="removeDocument('partner_pan_' + idx)" class="text-red-600 hover:text-red-800">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </div>
                      </label>
                    </div>
                    <div *ngIf="getExistingPartnerDocument('pan', idx)" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                      <small class="text-blue-800">
                        {{ getExistingPartnerDocument('pan', idx).file_name }} 
                        ({{ formatFileSize(getExistingPartnerDocument('pan', idx).file_size) }})
                      </small>
                      <button (click)="downloadPartnerDocument('pan', idx)" class="text-blue-600 hover:text-blue-800">
                        <mat-icon>download</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 5: Financial Information Section -->
      <div *ngIf="currentStep === 5">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-emerald-600 text-lg">account_balance</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Financial Information</h3>
              <p class="text-sm text-gray-600">Banking details and financial requirements</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Required Loan Amount -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Required Loan Amount</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <span class="text-emerald-600 font-semibold text-lg">₹</span>
                </div>
                <input type="number" 
                       formControlName="required_loan_amount"
                       placeholder="0.00"
                       min="0"
                       step="1000"
                       class="w-full pl-8 pr-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 hover:border-gray-400 transition-colors shadow-sm"
                       [class.border-red-500]="clientForm.get('required_loan_amount')?.hasError('min') && clientForm.get('required_loan_amount')?.touched"
                       [class.focus:ring-red-500]="clientForm.get('required_loan_amount')?.hasError('min') && clientForm.get('required_loan_amount')?.touched">
              </div>
              <div *ngIf="clientForm.get('required_loan_amount')?.hasError('min') && clientForm.get('required_loan_amount')?.touched" class="mt-1 text-sm text-red-600">
                Amount must be positive
              </div>
            </div>

            <!-- Total Credit Amount -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Total Credit Amount</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <span class="text-emerald-600 font-semibold text-lg">₹</span>
                </div>
                <input type="number" 
                       formControlName="total_credit_amount"
                       placeholder="0.00"
                       min="0"
                       step="1000"
                       class="w-full pl-8 pr-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 hover:border-gray-400 transition-colors shadow-sm"
                       [class.border-red-500]="clientForm.get('total_credit_amount')?.hasError('min') && clientForm.get('total_credit_amount')?.touched"
                       [class.focus:ring-red-500]="clientForm.get('total_credit_amount')?.hasError('min') && clientForm.get('total_credit_amount')?.touched">
              </div>
              <div *ngIf="clientForm.get('total_credit_amount')?.hasError('min') && clientForm.get('total_credit_amount')?.touched" class="mt-1 text-sm text-red-600">
                Amount must be positive
              </div>
            </div>

            <!-- Loan Purpose -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Loan Purpose</label>
              <input type="text" 
                     formControlName="loan_purpose"
                     placeholder="Enter loan purpose"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Repayment Period -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Repayment Period</label>
              <input type="text" 
                     formControlName="repayment_period"
                     placeholder="Enter repayment period"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 6: Bank Information Section -->
      <div *ngIf="currentStep === 6">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-cyan-600 text-lg">account_balance_wallet</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Bank Information</h3>
              <p class="text-sm text-gray-600">Current banking details and account information</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Bank Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Bank Name</label>
              <input type="text" 
                     formControlName="bank_name"
                     placeholder="Enter bank name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Account Name -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Account Name</label>
              <input type="text" 
                     formControlName="account_name"
                     placeholder="Enter account holder name"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- Account Number -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Account Number</label>
              <input type="text" 
                     formControlName="account_number"
                     placeholder="Enter account number"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm">
            </div>

            <!-- IFSC Code -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">IFSC Code</label>
              <input type="text" 
                     formControlName="ifsc_code"
                     placeholder="Enter IFSC code"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('ifsc_code')?.hasError('pattern') && clientForm.get('ifsc_code')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('ifsc_code')?.hasError('pattern') && clientForm.get('ifsc_code')?.touched">
              <div *ngIf="clientForm.get('ifsc_code')?.hasError('pattern') && clientForm.get('ifsc_code')?.touched" class="mt-1 text-sm text-red-600">
                Please enter a valid IFSC code
              </div>
            </div>

            <!-- Bank Account Type -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">Bank Account Type</label>
              <div class="relative">
                <button type="button"
                        (click)="toggleBankTypeDropdown()"
                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm"
                        [class.border-cyan-500]="isBankTypeDropdownOpen"
                        [class.ring-2]="isBankTypeDropdownOpen"
                        [class.ring-cyan-500]="isBankTypeDropdownOpen">
                  <span class="block truncate text-gray-700">
                    {{ getBankTypeLabel(clientForm.get('bank_type')?.value) }}
                  </span>
                  <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-400 transition-transform duration-200"
                         [class.rotate-180]="isBankTypeDropdownOpen"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </span>
                </button>
                
                <!-- Dropdown Options -->
                <div *ngIf="isBankTypeDropdownOpen"
                     class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                  <button type="button"
                          (click)="selectBankType('')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-cyan-50]="clientForm.get('bank_type')?.value === ''"
                          [class.text-cyan-600]="clientForm.get('bank_type')?.value === ''">
                    Select Account Type
                  </button>
                  <button type="button"
                          (click)="selectBankType('Savings')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-cyan-50]="clientForm.get('bank_type')?.value === 'Savings'"
                          [class.text-cyan-600]="clientForm.get('bank_type')?.value === 'Savings'">
                    Savings
                  </button>
                  <button type="button"
                          (click)="selectBankType('Current')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                          [class.bg-cyan-50]="clientForm.get('bank_type')?.value === 'Current'"
                          [class.text-cyan-600]="clientForm.get('bank_type')?.value === 'Current'">
                    Current
                  </button>
                </div>
              </div>
            </div>

            <!-- New Current Account -->
            <div class="w-full">
              <label class="block text-sm font-medium text-gray-700 mb-2">New Current Account</label>
              <div class="relative">
                <button type="button"
                        (click)="toggleNewCurrentAccountDropdown()"
                        class="w-full bg-white border border-gray-300 rounded-lg px-3 py-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm"
                        [class.border-cyan-500]="isNewCurrentAccountDropdownOpen"
                        [class.ring-2]="isNewCurrentAccountDropdownOpen"
                        [class.ring-cyan-500]="isNewCurrentAccountDropdownOpen">
                  <span class="block truncate text-gray-700">
                    {{ getNewCurrentAccountLabel(clientForm.get('new_current_account')?.value) }}
                  </span>
                  <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-400 transition-transform duration-200"
                         [class.rotate-180]="isNewCurrentAccountDropdownOpen"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </span>
                </button>
                
                <!-- Dropdown Options -->
                <div *ngIf="isNewCurrentAccountDropdownOpen"
                     class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                  <button type="button"
                          (click)="selectNewCurrentAccount('yes')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100"
                          [class.bg-cyan-50]="clientForm.get('new_current_account')?.value === 'yes'"
                          [class.text-cyan-600]="clientForm.get('new_current_account')?.value === 'yes'">
                    Yes
                  </button>
                  <button type="button"
                          (click)="selectNewCurrentAccount('no')"
                          class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                          [class.bg-cyan-50]="clientForm.get('new_current_account')?.value === 'no'"
                          [class.text-cyan-600]="clientForm.get('new_current_account')?.value === 'no'">
                    No
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- New Bank Details Section (Show when New Current Account is Yes) -->
          <div *ngIf="clientForm.get('new_current_account')?.value === 'yes'" class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h4 class="text-base font-semibold text-gray-800 mb-4">New Bank Account Details</h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
              <!-- New Bank Name -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">New Bank Name</label>
                <input type="text" 
                       formControlName="new_bank_name" 
                       (input)="onNewBankNameInput($event)" 
                       placeholder="Type to search new bank name" 
                       autocomplete="off"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>

              <!-- New Account Name -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">New Account Name</label>
                <input type="text" 
                       formControlName="new_account_name" 
                       placeholder="Enter new account holder name"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>
            </div>
            
            <div *ngIf="filteredNewBankNames.length > 0" class="mb-4">
              <div class="max-h-40 overflow-y-auto border border-gray-300 rounded-lg">
                <div *ngFor="let bank of filteredNewBankNames.slice(0, 10)" 
                     class="px-3 py-2 hover:bg-blue-100 cursor-pointer border-b border-gray-200 last:border-b-0" 
                     (click)="selectNewBank(bank)">
                  {{ bank }}
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- New Bank Account Number -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">New Bank Account Number</label>
                <input type="text" 
                       formControlName="new_bank_account_number" 
                       placeholder="Enter new bank account number"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>

              <!-- New IFSC Code -->
              <div class="w-full">
                <label class="block text-sm font-medium text-gray-700 mb-2">New IFSC Code</label>
                <input type="text" 
                       formControlName="new_ifsc_code" 
                       placeholder="Enter new IFSC code"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 transition-colors shadow-sm">
              </div>
            </div>
          </div>

          <!-- Number of Months Transaction Shared -->
          <div class="mt-6">
            <div class="w-full md:w-1/2">
              <label class="block text-sm font-medium text-gray-700 mb-2">Number of Months Transaction Shared</label>
              <input type="number" 
                     formControlName="transaction_months" 
                     min="1"
                     placeholder="Enter number of months"
                     class="w-full px-3 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 hover:border-gray-400 transition-colors shadow-sm"
                     [class.border-red-500]="clientForm.get('transaction_months')?.hasError('min') && clientForm.get('transaction_months')?.touched"
                     [class.focus:ring-red-500]="clientForm.get('transaction_months')?.hasError('min') && clientForm.get('transaction_months')?.touched">
              <div *ngIf="clientForm.get('transaction_months')?.hasError('min') && clientForm.get('transaction_months')?.touched" class="mt-1 text-sm text-red-600">
                Must be at least 1 month
              </div>
            </div>
          </div>

          <!-- Bank Statements Section -->
          <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex items-center gap-3 mb-4">
              <mat-icon class="text-blue-600">description</mat-icon>
              <div>
                <h4 class="text-base font-semibold text-gray-800">Bank Statements</h4>
                <p class="text-sm text-gray-600">Upload your recent bank statements for verification</p>
              </div>
            </div>
            
            <!-- Existing Bank Statements -->
            <div *ngIf="getExistingBankStatements().length > 0" class="mb-6">
              <div class="flex items-center gap-2 mb-3">
                <mat-icon class="text-green-600">folder</mat-icon>
                <h5 class="text-sm font-semibold text-gray-800">Existing Bank Statements</h5>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let statement of getExistingBankStatements(); let i = index" class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm">
                  <div class="flex items-start gap-3">
                    <mat-icon class="text-blue-600 mt-1">insert_drive_file</mat-icon>
                    <div class="flex-1 min-w-0">
                      <span class="text-sm font-medium text-gray-800 block">Bank Statement {{ i + 1 }}</span>
                      <div class="space-y-1">
                        <small *ngIf="statement.file_name" class="text-xs text-text-muted block truncate">{{ statement.file_name }}</small>
                        <small *ngIf="statement.file_size" class="text-xs text-gray-600 block">{{ formatFileSize(statement.file_size) }}</small>
                      </div>
                    </div>
                    <button class="w-8 h-8 rounded-lg bg-blue-100 hover:bg-blue-200 flex items-center justify-center transition-colors" matTooltip="Download">
                      <mat-icon class="text-blue-600 text-sm">download</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- New Bank Statement Uploads -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <mat-icon class="text-purple-600">cloud_upload</mat-icon>
                <h5 class="text-sm font-semibold text-gray-800">{{ getExistingBankStatements().length > 0 ? 'Update Bank Statements' : 'Upload Bank Statements' }}</h5>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                <div *ngFor="let i of [].constructor(bankStatementsCount); let idx = index" class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                     [ngClass]="{'border-green-500 bg-green-50': documents['bank_statement_' + idx]}">
                  <input type="file" [id]="'bank_statement_' + idx" (change)="onFileSelected($event, 'bank_statement_' + idx)" accept=".pdf,.jpg,.jpeg,.png" class="hidden">
                  <label [for]="'bank_statement_' + idx" class="cursor-pointer">
                    <div *ngIf="!documents['bank_statement_' + idx]">
                      <mat-icon class="text-3xl mb-2 text-gray-400">cloud_upload</mat-icon>
                      <span class="block text-sm font-medium text-gray-800">Bank Statement {{ idx + 1 }}</span>
                      <small class="text-xs text-gray-600">Click to upload PDF, JPG, PNG</small>
                    </div>
                    <div *ngIf="documents['bank_statement_' + idx]" class="space-y-2">
                      <mat-icon class="text-3xl text-green-600">check_circle</mat-icon>
                      <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-800 truncate">{{ documents['bank_statement_' + idx].name }}</span>
                        <button type="button" (click)="removeDocument('bank_statement_' + idx)" class="text-red-600 hover:text-red-800 ml-2" matTooltip="Remove file">
                          <mat-icon class="text-sm">close</mat-icon>
                        </button>
                      </div>
                    </div>
                  </label>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <button type="button" (click)="addBankStatement()" *ngIf="bankStatementsCount < 6" 
                        class="flex items-center gap-2 px-3 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors" 
                        matTooltip="Add more bank statements">
                  <mat-icon class="text-sm">add</mat-icon>
                  <span>Add Statement</span>
                </button>
                <button type="button" (click)="removeBankStatement()" *ngIf="bankStatementsCount > 1" 
                        class="flex items-center gap-2 px-3 py-2 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors" 
                        matTooltip="Remove last statement">
                  <mat-icon class="text-sm">remove</mat-icon>
                  <span>Remove Statement</span>
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
      </div>

      <!-- Step 7: Upload Signature Section -->
      <div *ngIf="currentStep === 7">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Additional Documents</h3>
              <p class="text-sm text-gray-600">Upload signature, product images, and user photos</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <!-- Signature Upload -->
          <div class="mb-8">
            <h4 class="text-base font-semibold text-gray-800 mb-4">Signature</h4>
            <div class="space-y-3">
              <label class="text-sm font-medium text-gray-800">Signature Upload</label>
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors"
                   [ngClass]="{'border-green-500 bg-green-50': documents['signature']}">
                <input type="file" id="signature" (change)="onFileSelected($event, 'signature')" accept=".jpg,.jpeg,.png" class="hidden">
                <label for="signature" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2" [ngClass]="{'text-green-600': documents['signature'], 'text-gray-400': !documents['signature']}">{{ documents['signature'] ? 'check_circle' : 'upload_file' }}</mat-icon>
                  <p class="text-sm" *ngIf="!documents['signature']">Upload Signature (JPG, PNG)</p>
                  <div *ngIf="documents['signature']" class="flex items-center justify-between">
                    <span class="text-sm font-medium">{{ documents['signature'].name }}</span>
                    <button type="button" (click)="removeDocument('signature')" class="text-red-600 hover:text-red-800" matTooltip="Remove">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </label>
              </div>
              <div *ngIf="existingDocuments['signature']" class="flex items-center justify-between p-2 bg-blue-50 rounded">
                <small class="text-blue-800">
                  {{ existingDocuments['signature'].file_name }} 
                  ({{ formatFileSize(existingDocuments['signature'].file_size) }})
                </small>
                <button (click)="downloadDocument('signature')" class="text-blue-600 hover:text-blue-800">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Product Images Upload -->
          <div class="mb-8">
            <h4 class="text-base font-semibold text-gray-800 mb-2">Product Images (Optional)</h4>
            <p class="text-sm text-gray-600 mb-4">Upload 1 to 10 product images</p>
            <div class="space-y-3">
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors">
                <input type="file" id="product_images" (change)="onMultipleFilesSelected($event, 'product_images')" accept=".jpg,.jpeg,.png" multiple class="hidden">
                <label for="product_images" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2 text-gray-400">add_photo_alternate</mat-icon>
                  <p class="text-sm">Upload Product Images (JPG, PNG) - Max 10</p>
                  <p class="text-xs text-gray-500 mt-1">Selected: {{ getProductImagesCount() }} / 10</p>
                </label>
              </div>
              
              <!-- Display uploaded product images -->
              <div *ngIf="productImages && productImages.length > 0" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 mt-4">
                <div *ngFor="let image of productImages; let i = index" class="relative group">
                  <img [src]="getImagePreview(image)" class="w-full h-24 object-cover rounded-lg border border-gray-300">
                  <button type="button" (click)="removeProductImage(i)" 
                          class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <mat-icon class="text-sm">close</mat-icon>
                  </button>
                  <p class="text-xs text-gray-600 mt-1 truncate">{{ image.name }}</p>
                </div>
              </div>

              <!-- Display existing product images -->
              <div *ngIf="existingProductImages && existingProductImages.length > 0" class="mt-4">
                <p class="text-sm font-medium text-gray-700 mb-2">Existing Product Images</p>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                  <div *ngFor="let image of existingProductImages; let i = index" class="relative group">
                    <img [src]="image.url" class="w-full h-24 object-cover rounded-lg border border-gray-300">
                    <button type="button" (click)="deleteExistingProductImage(i)" 
                            class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                      <mat-icon class="text-sm">delete</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- User Photos Upload -->
          <div class="mb-8">
            <h4 class="text-base font-semibold text-gray-800 mb-2">User Photos (Optional)</h4>
            <p class="text-sm text-gray-600 mb-4">Upload 1 to 10 user photos</p>
            <div class="space-y-3">
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors">
                <input type="file" id="user_photos" (change)="onMultipleFilesSelected($event, 'user_photos')" accept=".jpg,.jpeg,.png" multiple class="hidden">
                <label for="user_photos" class="cursor-pointer">
                  <mat-icon class="text-3xl mb-2 text-gray-400">person_add_alt</mat-icon>
                  <p class="text-sm">Upload User Photos (JPG, PNG) - Max 10</p>
                  <p class="text-xs text-gray-500 mt-1">Selected: {{ getUserPhotosCount() }} / 10</p>
                </label>
              </div>
              
              <!-- Display uploaded user photos -->
              <div *ngIf="userPhotos && userPhotos.length > 0" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 mt-4">
                <div *ngFor="let photo of userPhotos; let i = index" class="relative group">
                  <img [src]="getImagePreview(photo)" class="w-full h-24 object-cover rounded-lg border border-gray-300">
                  <button type="button" (click)="removeUserPhoto(i)" 
                          class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <mat-icon class="text-sm">close</mat-icon>
                  </button>
                  <p class="text-xs text-gray-600 mt-1 truncate">{{ photo.name }}</p>
                </div>
              </div>

              <!-- Display existing user photos -->
              <div *ngIf="existingUserPhotos && existingUserPhotos.length > 0" class="mt-4">
                <p class="text-sm font-medium text-gray-700 mb-2">Existing User Photos</p>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
                  <div *ngFor="let photo of existingUserPhotos; let i = index" class="relative group">
                    <img [src]="photo.url" class="w-full h-24 object-cover rounded-lg border border-gray-300">
                    <button type="button" (click)="deleteExistingUserPhoto(i)" 
                            class="absolute top-1 right-1 bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                      <mat-icon class="text-sm">delete</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Step 8: Payment Gateway Section -->
      <div *ngIf="currentStep === 8">
      <div class="backdrop-blur-xl bg-white/70 rounded-2xl shadow-xl border border-white/20 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-rose-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-rose-600 text-lg">payment</mat-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">Payment Gateway Configuration</h3>
              <p class="text-sm text-gray-600">Select available payment methods for your business</p>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-6">
            <div class="space-y-4">
              <div class="flex items-center gap-3">
                <mat-icon class="text-primary">tune</mat-icon>
                <h4 class="text-base font-semibold text-gray-800">Available Payment Gateways</h4>
              </div>
              <p class="text-sm text-gray-600">Choose one or more payment gateways that your business will support:</p>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let gateway of availableGateways" class="relative">
                  <mat-checkbox 
                    [checked]="isGatewaySelected(gateway)"
                    (change)="onGatewayChange(gateway, $event.checked)"
                    class="w-full">
                    <div class="flex items-center gap-3 p-3 border-2 border-gray-200 rounded-xl hover:border-primary transition-all duration-200 hover:shadow-md"
                         [ngClass]="{'border-primary bg-primary/5 shadow-md': isGatewaySelected(gateway)}">
                      <!-- Gateway Icons -->
                      <!-- Razorpay Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('razorpay')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #3395ff 0%, #0066cc 100%);">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M22.436 0l-11.91 7.773-1.174 4.276 6.625-4.297L11.65 24h4.391l6.395-24zM1.564 0h5.5l-5.5 8.25V0z"/>
                        </svg>
                      </div>
                      <!-- PayU Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('payu')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #17b978 0%, #0e8c5a 100%);">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                      </div>
                      <!-- Paytm Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('paytm')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #00baf2 0%, #0095c7 100%);">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2l-2-4 2-4h2l-2 4 2 4z"/>
                        </svg>
                      </div>
                      <!-- PhonePe Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('phonepe')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #5f259f 0%, #3d1766 100%);">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                      </div>
                      <!-- Stripe Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('stripe')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #635bff 0%, #4a42d6 100%);">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                        </svg>
                      </div>
                      <!-- CCAvenue Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('ccavenue')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #ff6b35 0%, #e04e1f 100%);">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                          <circle cx="12" cy="12" r="2" fill="currentColor"/>
                        </svg>
                      </div>
                      <!-- Cashfree Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('cashfree')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #0d47a1 0%, #083570 100%);">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                      </div>
                      <!-- Instamojo Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('instamojo')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #3d5afe 0%, #2c3fd6 100%);">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M12 2L2 7v10c0 5.55 3.84 10.74 10 12 6.16-1.26 10-6.45 10-12V7l-10-5zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                        </svg>
                      </div>
                      <!-- Easebuzz Icon -->
                      <div *ngIf="gateway.toLowerCase().includes('easebuzz')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #ff6f00 0%, #d65500 100%);">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                      </div>
                      <!-- Default Payment Icon for others -->
                      <div *ngIf="!gateway.toLowerCase().includes('razorpay') && 
                                  !gateway.toLowerCase().includes('payu') && 
                                  !gateway.toLowerCase().includes('paytm') && 
                                  !gateway.toLowerCase().includes('phonepe') && 
                                  !gateway.toLowerCase().includes('stripe') && 
                                  !gateway.toLowerCase().includes('ccavenue') && 
                                  !gateway.toLowerCase().includes('cashfree') && 
                                  !gateway.toLowerCase().includes('instamojo') &&
                                  !gateway.toLowerCase().includes('easebuzz')" 
                           class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md bg-gradient-to-br from-purple-500 to-indigo-600">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                      </div>
                      <span class="text-sm font-semibold text-gray-800">{{ gateway }}</span>
                    </div>
                  </mat-checkbox>
                </div>
              </div>
            </div>
            
            <div class="border-t border-gray-200 pt-6">
              <div *ngIf="getSelectedGateways().length > 0" class="space-y-4">
                <div class="flex items-center gap-3">
                  <mat-icon class="text-green-600">check_circle</mat-icon>
                  <h5 class="text-base font-semibold text-gray-800">Selected Payment Gateways ({{ getSelectedGateways().length }})</h5>
                </div>
                <div class="flex flex-wrap gap-3">
                  <div *ngFor="let gateway of getSelectedGateways()" 
                       class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-br from-white to-gray-50 border-2 shadow-sm hover:shadow-md transition-all duration-200"
                       [style.border-color]="getGatewayColor(gateway) + '40'">
                    <!-- Gateway Icon -->
                    <!-- Razorpay Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('razorpay')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #3395ff 0%, #0066cc 100%);">
                      <svg class="w-6 h-6 text-yellow-300" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M22.436 0l-11.91 7.773-1.174 4.276 6.625-4.297L11.65 24h4.391l6.395-24zM1.564 0h5.5l-5.5 8.25V0z"/>
                      </svg>
                    </div>
                    <!-- PayU Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('payu')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #17b978 0%, #0e8c5a 100%);">
                      <svg class="w-6 h-6 text-yellow-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <!-- Paytm Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('paytm')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #00baf2 0%, #0095c7 100%);">
                      <svg class="w-6 h-6 text-cyan-100" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2l-2-4 2-4h2l-2 4 2 4z"/>
                      </svg>
                    </div>
                    <!-- PhonePe Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('phonepe')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #5f259f 0%, #3d1766 100%);">
                      <svg class="w-6 h-6 text-purple-200" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                      </svg>
                    </div>
                    <!-- Stripe Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('stripe')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #635bff 0%, #4a42d6 100%);">
                      <svg class="w-6 h-6 text-green-200" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                      </svg>
                    </div>
                    <!-- CCAvenue Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('ccavenue')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #ff6b35 0%, #e04e1f 100%);">
                      <svg class="w-6 h-6 text-yellow-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                        <circle cx="12" cy="12" r="2" fill="currentColor"/>
                      </svg>
                    </div>
                    <!-- Cashfree Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('cashfree')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #0d47a1 0%, #083570 100%);">
                      <svg class="w-6 h-6 text-amber-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                      </svg>
                    </div>
                    <!-- Instamojo Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('instamojo')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #3d5afe 0%, #2c3fd6 100%);">
                      <svg class="w-6 h-6 text-pink-200" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 10 12 6.16-1.26 10-6.45 10-12V7l-10-5zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                      </svg>
                    </div>
                    <!-- PayPal Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('paypal')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #0070ba 0%, #005a94 100%);">
                      <svg class="w-6 h-6 text-blue-200" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 00-.794.68l-.04.22-.63 3.993-.028.15a.805.805 0 01-.793.68H7.723c-.35 0-.634-.28-.576-.622l1.713-10.86a.805.805 0 01.794-.68h2.535c3.238 0 5.774-1.314 6.514-5.12.256-1.313.192-2.447-.3-3.327a3.31 3.31 0 00-.725-.904c.577.35 1.04.84 1.39 1.443z"/>
                      </svg>
                    </div>
                    <!-- Easebuzz Icon -->
                    <div *ngIf="gateway.toLowerCase().includes('easebuzz')" class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #ff9800 0%, #e68900 100%);">
                      <svg class="w-6 h-6 text-yellow-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                      </svg>
                    </div>
                    <!-- Default Payment Icon for others -->
                    <div *ngIf="!gateway.toLowerCase().includes('razorpay') && 
                                !gateway.toLowerCase().includes('payu') && 
                                !gateway.toLowerCase().includes('paytm') && 
                                !gateway.toLowerCase().includes('phonepe') && 
                                !gateway.toLowerCase().includes('stripe') && 
                                !gateway.toLowerCase().includes('ccavenue') && 
                                !gateway.toLowerCase().includes('cashfree') && 
                                !gateway.toLowerCase().includes('instamojo') &&
                                !gateway.toLowerCase().includes('paypal') &&
                                !gateway.toLowerCase().includes('easebuzz')" 
                         class="w-10 h-10 rounded-lg flex items-center justify-center shadow-md" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                      <svg class="w-6 h-6 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                      </svg>
                    </div>
                    
                    <!-- Gateway Name -->
                    <span class="text-sm font-semibold text-gray-800 flex-1">{{ gateway }}</span>
                    
                    <!-- Status Badge -->
                    <span class="px-2.5 py-1 text-xs rounded-full font-semibold bg-yellow-100 text-yellow-800 border border-yellow-200">
                      • Pending
                    </span>
                    
                    <!-- Remove Button -->
                    <button (click)="onGatewayChange(gateway, false)" 
                            class="w-7 h-7 rounded-full bg-gray-100 hover:bg-red-100 flex items-center justify-center transition-colors group"
                            [matTooltip]="'Remove ' + gateway">
                      <mat-icon class="text-sm text-gray-600 group-hover:text-red-600">close</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <div *ngIf="getSelectedGateways().length === 0" class="text-center py-8">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <mat-icon class="text-gray-400 text-2xl">info</mat-icon>
                </div>
                <p class="text-text-muted font-medium">No payment gateways selected yet</p>
                <p class="text-sm text-gray-600 mt-1">Please select at least one payment gateway above</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="flex items-center justify-between mt-8 p-6 bg-white rounded-2xl shadow-xl border border-gray-200">
        <button type="button" 
                (click)="previousStep()" 
                [disabled]="currentStep === 0"
                class="flex items-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
          <mat-icon>arrow_back</mat-icon>
          Previous
        </button>

        <div class="text-center">
          <span class="text-sm font-semibold text-gray-600">Step {{ currentStep + 1 }} of {{ totalSteps }}</span>
        </div>

        <button type="button" 
                *ngIf="currentStep < totalSteps - 1"
                (click)="nextStep()" 
                class="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-md">
          Next
          <mat-icon>arrow_forward</mat-icon>
        </button>

        <button type="button" 
                *ngIf="currentStep === totalSteps - 1"
                (click)="saveClient()" 
                [disabled]="saving"
                class="flex items-center gap-2 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-all duration-200 shadow-md disabled:opacity-50">
          <div *ngIf="saving" class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>
          <mat-icon *ngIf="!saving">save</mat-icon>
          {{ saving ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>

    </form>
  </div>
</div>
