<!-- Main Container with Gradient Background -->
<div class="min-h-screen bg-gradient-body">

  <!-- Main Content Layout -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    
    <!-- Horizontal Filters Section -->
    <div class="bg-white rounded-xl shadow-sm border border-border-light p-6 mb-6">
      <!-- Filters Header -->
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-text-primary flex items-center gap-2">
          <mat-icon class="text-primary">filter_list</mat-icon>
          Filters
        </h3>
        <div class="flex items-center gap-3">
          <!-- View Toggle -->
          <div class="flex items-center gap-2">
            <button 
              (click)="viewMode = 'table'" 
              [class]="viewMode === 'table' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
              class="flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200"
              matTooltip="Table View">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 6h18m-9 8h9m-9 4h9m-9-8H3m0 4h6"></path>
              </svg>
            </button>
            <button 
              (click)="viewMode = 'card'" 
              [class]="viewMode === 'card' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'"
              class="flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200"
              matTooltip="Card View">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14-7H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2z"></path>
              </svg>
            </button>
          </div>
          <button 
            *ngIf="hasActiveFilters()" 
            (click)="clearAllFilters()"
            class="px-4 py-2 text-sm font-medium text-primary hover:text-primary-dark border border-primary rounded-lg hover:bg-primary/5 transition-colors">
            Clear All Filters
          </button>
        </div>
      </div>

      <!-- Filter Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        
        <!-- Search Filter -->
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium text-text-primary mb-2">Search Enquiries</label>
          <div class="relative">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              (input)="applyFilters()"
              placeholder="Name, mobile, business..."
              class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted text-lg">search</mat-icon>
          </div>
        </div>

        <!-- Staff Filter -->
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">Assigned Staff</label>
          <select 
            [(ngModel)]="staffFilter" 
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <option value="all">All Staff ({{ getStaffCount('all') }})</option>
            <option *ngFor="let staff of uniqueStaffMembers" [value]="staff">
              {{ staff }} ({{ getStaffCount(staff) }})
            </option>
          </select>
        </div>

        <!-- GST Filter -->
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">GST Status</label>
          <select 
            [(ngModel)]="gstFilter" 
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <option value="all">All GST ({{ getGstCount('all') }})</option>
            <option value="yes">GST Active ({{ getGstCount('yes') }})</option>
            <option value="not_selected">Not Selected ({{ getGstCount('not_selected') }})</option>
          </select>
        </div>

        <!-- Interest Level Filter -->
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">Interest Level</label>
          <select 
            [(ngModel)]="interestFilter" 
            (change)="applyFilters()"
            class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <option value="all">All Interest ({{ getInterestCount('all') }})</option>
            <option value="interested">Interested ({{ getInterestCount('interested') }})</option>
            <option value="not_interested">Not Interested ({{ getInterestCount('not_interested') }})</option>
            <option value="no_gst">No GST ({{ getInterestCount('no_gst') }})</option>
            <option value="gst_cancelled">GST Cancelled ({{ getInterestCount('gst_cancelled') }})</option>
            <option value="pending">Pending ({{ getInterestCount('pending') }})</option>
            <option value="unknown">Unknown ({{ getInterestCount('unknown') }})</option>
          </select>
        </div>
      </div>

      <!-- Date Range and Sort Filter Row -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-border-light">
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">From Date</label>
          <input type="date" 
                 [(ngModel)]="fromDate" 
                 (change)="applyFilters()"
                 class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
        </div>
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">To Date</label>
          <input type="date" 
                 [(ngModel)]="toDate" 
                 (change)="applyFilters()"
                 class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
        </div>
        <div>
          <label class="block text-sm font-medium text-text-primary mb-2">Sort By</label>
          <select 
            [(ngModel)]="sortOption" 
            (change)="onSortChange()"
            class="w-full px-3 py-2 border border-border-light rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
            <option value="date_new">Newest First</option>
            <option value="date_old">Oldest First</option>
            <option value="name_asc">Name A-Z</option>
            <option value="name_desc">Name Z-A</option>
          </select>
        </div>
        <div class="flex items-end">
          <button 
            *ngIf="fromDate || toDate"
            (click)="clearDateRange()" 
            class="w-full px-4 py-2 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 hover:border-red-300 transition-colors">
            Clear Date Range
          </button>
        </div>
      </div>
    </div>

    <!-- Results Header -->
    <div class="bg-white rounded-xl shadow-sm border border-border-light p-4 mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-4">
          <h2 class="text-lg font-semibold text-text-primary">
            Enquiries ({{ filteredEnquiries.length }})
          </h2>
          
          <!-- Active Filters Display -->
          <div *ngIf="hasActiveFilters()" class="flex flex-wrap gap-2">
            <span *ngIf="searchTerm" class="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
              Search: "{{ searchTerm }}"
              <button (click)="searchTerm = ''; applyFilters()" class="hover:bg-blue-200 rounded-full p-0.5">
                <mat-icon class="text-xs">close</mat-icon>
              </button>
            </span>
            <span *ngIf="staffFilter !== 'all'" class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">
              Staff: {{ staffFilter }}
              <button (click)="clearStaffFilter()" class="hover:bg-green-200 rounded-full p-0.5">
                <mat-icon class="text-xs">close</mat-icon>
              </button>
            </span>
            <span *ngIf="gstFilter !== 'all'" class="inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">
              GST: {{ getGstFilterDisplay() }}
              <button (click)="clearGstFilter()" class="hover:bg-purple-200 rounded-full p-0.5">
                <mat-icon class="text-xs">close</mat-icon>
              </button>
            </span>
            <span *ngIf="interestFilter !== 'all'" class="inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">
              Interest: {{ getInterestLevelDisplay() }}
              <button (click)="clearInterestFilter()" class="hover:bg-orange-200 rounded-full p-0.5">
                <mat-icon class="text-xs">close</mat-icon>
              </button>
            </span>
            <span *ngIf="fromDate || toDate" class="inline-flex items-center gap-1 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">
              Date: {{ formatDateRange() }}
              <button (click)="clearDateRange()" class="hover:bg-indigo-200 rounded-full p-0.5">
                <mat-icon class="text-xs">close</mat-icon>
              </button>
            </span>
          </div>
        </div>
        
        <!-- Clear All Filters -->
        <button 
          *ngIf="hasActiveFilters()" 
          (click)="clearAllFilters()"
          class="btn btn-outline text-status-error border-status-error hover:bg-status-error hover:text-white flex items-center gap-2 px-3 py-1.5 text-sm">
          <mat-icon class="text-sm">clear_all</mat-icon>
          Clear All
        </button>
      </div>
    </div>
