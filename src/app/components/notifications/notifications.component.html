<!-- Notifications Page -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-indigo-50 p-4 md:p-6">
  <!-- Page Header -->
  <div class="bg-gradient-to-r from-white to-gray-50 rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <!-- Header Left -->
      <div class="flex items-center gap-4">
        <button mat-icon-button 
                (click)="goBack()" 
                class="bg-gray-100 hover:bg-gray-200 transition-colors duration-200 rounded-full">
          <mat-icon class="text-gray-600">arrow_back</mat-icon>
        </button>
        <div class="flex-1">
          <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
            Recent Notifications
          </h1>
          <p class="text-sm text-gray-600 mt-1" *ngIf="getTotalNotificationCount() > 0">
            <span class="inline-flex items-center gap-1">
              <mat-icon class="text-indigo-500 text-sm">notifications_active</mat-icon>
              {{ getTotalNotificationCount() }} new notification{{ getTotalNotificationCount() > 1 ? 's' : '' }}
            </span>
          </p>
          <p class="text-sm text-green-600 mt-1 flex items-center gap-1" *ngIf="getTotalNotificationCount() === 0">
            <mat-icon class="text-green-500 text-sm">check_circle</mat-icon>
            You're all caught up!
          </p>
        </div>
      </div>
      
      <!-- Header Actions -->
      <div class="flex flex-wrap gap-3">
        <button mat-raised-button 
                (click)="markAllAsRead()" 
                [disabled]="getTotalNotificationCount() === 0"
                matTooltip="Mark all as read"
                class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
          <mat-icon class="mr-2">drafts</mat-icon>
          Mark All Read
        </button>
        <button mat-raised-button 
                (click)="clearAllNotifications()" 
                [disabled]="getTotalNotificationCount() === 0"
                matTooltip="Clear all notifications"
                class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
          <mat-icon class="mr-2">delete_sweep</mat-icon>
          Clear All
        </button>
      </div>
    </div>
  </div>

  <!-- Notifications Container -->
  <div class="space-y-6">
    <!-- Loading State -->
    <div *ngIf="isLoadingNotifications" 
         class="flex flex-col items-center justify-center py-16 bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-200 shadow-sm">
      <mat-spinner diameter="40" class="mb-4"></mat-spinner>
      <p class="text-gray-600 text-lg">Loading notifications...</p>
    </div>

    <!-- No Notifications State -->
    <div *ngIf="!isLoadingNotifications && getTotalNotificationCount() === 0" 
         class="flex flex-col items-center justify-center py-16 bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-200 shadow-sm">
      <div class="w-20 h-20 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center mb-6">
        <mat-icon class="text-4xl text-green-600">notifications_none</mat-icon>
      </div>
      <h2 class="text-2xl font-bold text-gray-800 mb-2">No new notifications</h2>
      <p class="text-gray-600 text-center max-w-md">You're all caught up! Check back later for updates.</p>
    </div>

    <!-- Notifications Content -->
    <div *ngIf="!isLoadingNotifications && (getTotalNotificationCount() > 0 || (isAdmin() && pendingUsersCount > 0))" 
         class="space-y-8">
      
      <!-- Pending User Approvals Section (Admin Only) -->
      <div *ngIf="isAdmin() && pendingUsersCount > 0" 
           class="bg-gradient-to-br from-white to-orange-50 rounded-xl border border-orange-200 shadow-sm overflow-hidden">
        <!-- Section Header -->
        <div class="bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                <mat-icon class="text-white text-xl">person_add_alt</mat-icon>
              </div>
              <h3 class="text-xl font-bold text-white">Pending User Approvals</h3>
            </div>
            <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold animate-pulse">
              {{ pendingUsersCount }}
            </span>
          </div>
        </div>
        
        <!-- Pending Users List -->
        <div class="p-6 space-y-4">
          <div *ngFor="let user of pendingUsers" 
               class="bg-gradient-to-br from-white to-orange-50 rounded-lg border border-orange-200 p-6 hover:shadow-lg transition-all duration-300">
            <div class="flex flex-col lg:flex-row lg:items-center gap-4">
              <!-- User Indicator -->
              <div class="flex items-center gap-4 flex-1">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center flex-shrink-0">
                  <mat-icon class="text-orange-600 text-xl">person_add_alt</mat-icon>
                </div>
                
                <!-- User Content -->
                <div class="flex-1 min-w-0">
                  <!-- Header -->
                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3">
                    <div class="flex items-center gap-2">
                      <span class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-1 rounded-full text-xs font-semibold">
                        <mat-icon class="text-xs mr-1">person_add_alt</mat-icon>
                        New Registration
                      </span>
                    </div>
                    <span class="text-sm text-gray-500 flex items-center gap-1">
                      <mat-icon class="text-xs">schedule</mat-icon>
                      {{ getTimeAgo(user.created_at) }}
                    </span>
                  </div>
                  
                  <!-- User Details -->
                  <div class="space-y-2">
                    <div class="font-semibold text-gray-800 text-lg">{{ user.username }}</div>
                    <div class="text-gray-600">{{ user.email }}</div>
                    <div class="flex items-center gap-2">
                      <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium animate-pulse">
                        PENDING APPROVAL
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Actions -->
              <div class="flex gap-3 flex-shrink-0">
                <button mat-raised-button 
                        (click)="approveUser(user)" 
                        class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all duration-200">
                  <mat-icon class="mr-2">check</mat-icon>
                  Approve
                </button>
                <button mat-stroked-button 
                        (click)="rejectUser(user)" 
                        class="border-red-300 text-red-600 hover:bg-red-50 hover:border-red-400 transition-all duration-200">
                  <mat-icon class="mr-2">close</mat-icon>
                  Reject
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- New Clients Section -->
      <div *ngIf="newClientsCount > 0" 
           class="bg-gradient-to-br from-white to-blue-50 rounded-xl border border-blue-200 shadow-sm overflow-hidden">
        <!-- Section Header -->
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                <mat-icon class="text-white text-xl">person_add</mat-icon>
              </div>
              <h3 class="text-xl font-bold text-white">New Clients</h3>
            </div>
            <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold">
              {{ newClientsCount }}
            </span>
          </div>
        </div>
        
        <!-- New Clients List -->
        <div class="p-6 space-y-4">
          <div *ngFor="let client of newClientsList" 
               class="bg-gradient-to-br from-white to-blue-50 rounded-lg border border-blue-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group"
               (click)="onClientClick(client)">
            <div class="flex items-center gap-4">
              <!-- Client Indicator -->
              <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform duration-200">
                <mat-icon class="text-blue-600 text-xl">person_add</mat-icon>
              </div>
              
              <!-- Client Content -->
              <div class="flex-1 min-w-0">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3">
                  <div class="flex items-center gap-2">
                    <span class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 py-1 rounded-full text-xs font-semibold">
                      <mat-icon class="text-xs mr-1">person_add</mat-icon>
                      New Client
                    </span>
                  </div>
                  <span class="text-sm text-gray-500 flex items-center gap-1">
                    <mat-icon class="text-xs">schedule</mat-icon>
                    {{ getTimeAgo(client.created_at) }}
                  </span>
                </div>
                
                <!-- Client Details -->
                <div class="space-y-2">
                  <div class="font-semibold text-gray-800 text-lg">{{ client.legal_name || client.user_name }}</div>
                  <div class="text-gray-600" *ngIf="client.trade_name || client.business_name">
                    {{ client.trade_name || client.business_name }}
                  </div>
                  <div class="flex flex-wrap items-center gap-2">
                    <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs">
                      {{ client.constitution_type }}
                    </span>
                    <span class="px-2 py-1 rounded-full text-xs font-medium"
                          [ngClass]="{
                            'bg-green-100 text-green-800': client.status === 'approved',
                            'bg-yellow-100 text-yellow-800': client.status === 'pending',
                            'bg-red-100 text-red-800': client.status === 'rejected',
                            'bg-blue-100 text-blue-800': client.status === 'active',
                            'bg-gray-100 text-gray-800': !client.status || !['approved', 'pending', 'rejected', 'active'].includes(client.status)
                          }">
                      {{ client.status | uppercase }}
                    </span>
                  </div>
                </div>
              </div>
              
              <!-- New Badge -->
              <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1 rounded-full text-xs font-bold animate-pulse">
                NEW
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Updated Clients Section -->
      <div *ngIf="updatedClientsCount > 0" 
           class="bg-gradient-to-br from-white to-purple-50 rounded-xl border border-purple-200 shadow-sm overflow-hidden">
        <!-- Section Header -->
        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                <mat-icon class="text-white text-xl">edit</mat-icon>
              </div>
              <h3 class="text-xl font-bold text-white">Client Updates</h3>
            </div>
            <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold">
              {{ updatedClientsCount }}
            </span>
          </div>
        </div>
        
        <!-- Updated Clients List -->
        <div class="p-6 space-y-4">
          <div *ngFor="let client of updatedClientsList" 
               class="bg-gradient-to-br from-white to-purple-50 rounded-lg border border-purple-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group"
               (click)="onClientClick(client)">
            <div class="flex items-center gap-4">
              <!-- Client Indicator -->
              <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform duration-200">
                <mat-icon class="text-purple-600 text-xl">edit</mat-icon>
              </div>
              
              <!-- Client Content -->
              <div class="flex-1 min-w-0">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3">
                  <div class="flex items-center gap-2">
                    <span class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-3 py-1 rounded-full text-xs font-semibold">
                      <mat-icon class="text-xs mr-1">edit</mat-icon>
                      Client Updated
                    </span>
                  </div>
                  <span class="text-sm text-gray-500 flex items-center gap-1">
                    <mat-icon class="text-xs">schedule</mat-icon>
                    {{ getTimeAgo(client.updated_at) }}
                  </span>
                </div>
                
                <!-- Client Details -->
                <div class="space-y-2">
                  <div class="font-semibold text-gray-800 text-lg">{{ client.legal_name || client.user_name }}</div>
                  <div class="text-gray-600" *ngIf="client.trade_name || client.business_name">
                    {{ client.trade_name || client.business_name }}
                  </div>
                  <div class="flex items-center gap-2 text-sm text-gray-500" *ngIf="client.updated_by_name">
                    <mat-icon class="text-xs">person</mat-icon>
                    <span>Updated by {{ client.updated_by_name }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Updated Badge -->
              <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                UPDATED
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Status Changes Section (for all users) -->
      <div *ngIf="adminStatusChangesCount > 0" 
           class="bg-gradient-to-br from-white to-amber-50 rounded-xl border border-amber-200 shadow-sm overflow-hidden">
        <!-- Section Header -->
        <div class="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                <mat-icon class="text-white text-xl">gavel</mat-icon>
              </div>
              <h3 class="text-xl font-bold text-white">Admin Actions</h3>
            </div>
            <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold">
              {{ adminStatusChangesCount }}
            </span>
          </div>
        </div>
        
        <!-- Admin Actions List -->
        <div class="p-6 space-y-4">
          <div *ngFor="let client of adminStatusChangesList" 
               class="bg-gradient-to-br from-white to-amber-50 rounded-lg border border-amber-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group"
               (click)="onClientClick(client)">
            <div class="flex items-center gap-4">
              <!-- Admin Indicator -->
              <div class="w-12 h-12 bg-gradient-to-br from-amber-100 to-orange-100 rounded-full flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform duration-200">
                <mat-icon class="text-amber-600 text-xl">gavel</mat-icon>
              </div>
              
              <!-- Client Content -->
              <div class="flex-1 min-w-0">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3">
                  <div class="flex items-center gap-2">
                    <span class="bg-gradient-to-r from-amber-500 to-orange-600 text-white px-3 py-1 rounded-full text-xs font-semibold">
                      <mat-icon class="text-xs mr-1">gavel</mat-icon>
                      Status: {{ client.status | titlecase }}
                    </span>
                  </div>
                  <span class="text-sm text-gray-500 flex items-center gap-1">
                    <mat-icon class="text-xs">schedule</mat-icon>
                    {{ getTimeAgo(client.updated_at) }}
                  </span>
                </div>
                
                <!-- Client Details -->
                <div class="space-y-2">
                  <div class="font-semibold text-gray-800 text-lg">{{ client.legal_name || client.user_name }}</div>
                  <div class="text-gray-600" *ngIf="client.trade_name || client.business_name">
                    {{ client.trade_name || client.business_name }}
                  </div>
                  <div class="flex items-center gap-2 text-sm text-gray-500" *ngIf="client.updated_by_name">
                    <mat-icon class="text-xs">admin_panel_settings</mat-icon>
                    <span>Changed by {{ client.updated_by_name }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Status Badge -->
              <div class="px-3 py-1 rounded-full text-xs font-bold"
                   [ngClass]="{
                     'bg-green-100 text-green-800': client.status === 'approved',
                     'bg-yellow-100 text-yellow-800': client.status === 'pending',
                     'bg-red-100 text-red-800': client.status === 'rejected',
                     'bg-blue-100 text-blue-800': client.status === 'active',
                     'bg-gray-100 text-gray-800': !client.status || !['approved', 'pending', 'rejected', 'active'].includes(client.status)
                   }">
                {{ client.status | uppercase }}
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
