<!-- Modern Dialog Container -->
<div class="max-w-4xl mx-auto">
  <!-- Dialog Header -->
  <div mat-dialog-title class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-primary/5 to-secondary/5">
    <div class="flex flex-col">
      <h2 class="text-xl font-bold text-text-primary">Client Details</h2>
      <div *ngIf="client.enquiry_id" class="flex items-center gap-2 mt-1">
        <span class="text-sm text-gray-600">From Enquiry:</span>
        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full">
          ID: {{ client.enquiry_id }}
        </span>
      </div>
    </div>
    <button (click)="onClose()" 
            class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"
            matTooltip="Close">
      <mat-icon class="text-gray-600 text-lg">close</mat-icon>
    </button>
  </div>

  <div mat-dialog-content class="p-6 max-h-[70vh] overflow-y-auto">
    <!-- Client Summary -->
    <div class="bg-white rounded-xl shadow-sm border border-border-light p-6 mb-6">
      <div class="flex items-start gap-4">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-lg flex-shrink-0"
             [ngClass]="{'bg-gray-200': !client.legal_name && !client.user_name}">
          <mat-icon class="text-white text-2xl">account_circle</mat-icon>
        </div>
        <div class="flex-1 min-w-0">
          <h3 class="text-lg font-bold text-text-primary mb-2"
              [ngClass]="{'text-gray-400': !client.legal_name && !client.user_name}">
            {{ client.legal_name || client.user_name || 'Client Name Not Provided' }}
          </h3>
          <div class="space-y-2 mb-3">
            <div class="flex items-center gap-2 text-sm"
                 [ngClass]="{'text-gray-400': !client.email}">
              <mat-icon class="text-lg">email</mat-icon>
              <span>{{ client.email || 'Email Not Provided' }}</span>
            </div>
            <div class="flex items-center gap-2 text-sm"
                 [ngClass]="{'text-gray-400': !client.mobile_number}">
              <mat-icon class="text-lg">phone</mat-icon>
              <span>{{ client.mobile_number || 'Phone Not Provided' }}</span>
            </div>
          </div>
          <div class="flex flex-wrap gap-2">
            <span class="px-3 py-1 text-xs rounded-full font-medium text-white"
                  [style.background-color]="getStatusColor(client.status)">
              {{ client.status ? (client.status | titlecase) : 'Status: N/A' }}
            </span>
            <span class="px-3 py-1 text-xs rounded-full font-medium text-white"
                  [style.background-color]="getLoanStatusColor(getLoanStatus())">
              Loan Status: {{ getLoanStatus() | titlecase }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Information Sections -->
    <div class="space-y-6">
      <!-- Personal Information -->
      <div *ngIf="hasPersonalInfo()" class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-4 border-b border-border-light">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-purple-600 text-lg">person</mat-icon>
            </div>
            <h3 class="text-lg font-semibold text-text-primary">Personal Information</h3>
          </div>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngIf="client.legal_name" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Legal Name:</span>
              <span class="text-sm text-text-primary">{{ client.legal_name }}</span>
            </div>
            <div *ngIf="client['optional_mobile_number']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Optional Mobile:</span>
              <span class="text-sm text-text-primary">{{ client['optional_mobile_number'] }}</span>
            </div>
            <div *ngIf="client.email" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Email:</span>
              <span class="text-sm text-text-primary">{{ client.email }}</span>
            </div>
            <div *ngIf="client.mobile_number" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Mobile:</span>
              <span class="text-sm text-text-primary">{{ client.mobile_number }}</span>
            </div>
            <div *ngIf="client.date_of_birth" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Date of Birth:</span>
              <span class="text-sm text-text-primary">{{ formatDate(client.date_of_birth) }}</span>
            </div>
            <div *ngIf="client.gender" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Gender:</span>
              <span class="text-sm text-text-primary">{{ client.gender }}</span>
            </div>
            <div *ngIf="hasValue(client.address) || hasValue(client.district) || hasValue(client.state) || hasValue(client.pincode)" 
                 class="md:col-span-2 flex justify-between py-2">
              <span class="text-sm font-medium text-text-secondary">Address:</span>
              <span class="text-sm text-text-primary text-right max-w-xs">{{ formatAddress() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Business Information -->
      <div *ngIf="hasBusinessInfo()" class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-4 border-b border-border-light">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-blue-600 text-lg">business</mat-icon>
            </div>
            <h3 class="text-lg font-semibold text-text-primary">Business Information</h3>
          </div>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngIf="client.business_name" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Business Name:</span>
              <span class="text-sm text-text-primary">{{ client.business_name }}</span>
            </div>
            <div *ngIf="client['legal_business_name']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Legal Business Name:</span>
              <span class="text-sm text-text-primary">{{ client['legal_business_name'] }}</span>
            </div>
            <div *ngIf="client.business_type" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Business Type:</span>
              <span class="text-sm text-text-primary">{{ client.business_type }}</span>
            </div>
            <div *ngIf="client['constitution_type']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Constitution Type:</span>
              <span class="text-sm text-text-primary">{{ client['constitution_type'] }}</span>
            </div>
            <div *ngIf="client['has_business_pan']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Has Business PAN:</span>
              <span class="text-sm text-text-primary">{{ client['has_business_pan'] }}</span>
            </div>
            <div *ngIf="client['number_of_partners'] !== undefined" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Number of Partners:</span>
              <span class="text-sm text-text-primary">{{ client['number_of_partners'] }}</span>
            </div>
            <div *ngIf="client['business_pan']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Business PAN:</span>
              <span class="text-sm text-text-primary">{{ client['business_pan'] }}</span>
            </div>
            <div *ngIf="client['ie_code']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">IE Code:</span>
              <span class="text-sm text-text-primary">{{ client['ie_code'] }}</span>
            </div>
            <div *ngIf="client['website']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Website:</span>
              <span class="text-sm text-primary hover:text-primary-dark">
                <a [href]="client['website']" target="_blank" rel="noopener">{{ client['website'] }}</a>
              </span>
            </div>
            <div *ngIf="client.business_address" class="md:col-span-2 flex justify-between py-2">
              <span class="text-sm font-medium text-text-secondary">Business Address:</span>
              <span class="text-sm text-text-primary text-right max-w-xs">{{ client.business_address }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Banking Information -->
      <div *ngIf="hasBankingInfo()" class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-4 border-b border-border-light">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-green-600 text-lg">account_balance</mat-icon>
            </div>
            <h3 class="text-lg font-semibold text-text-primary">Banking Information</h3>
          </div>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngIf="client['bank_name']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Bank Name:</span>
              <span class="text-sm text-text-primary">{{ client['bank_name'] }}</span>
            </div>
            <div *ngIf="client['account_number']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Account Number:</span>
              <span class="text-sm text-text-primary">{{ client['account_number'] }}</span>
            </div>
            <div *ngIf="client['ifsc_code']" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">IFSC Code:</span>
              <span class="text-sm text-text-primary">{{ client['ifsc_code'] }}</span>
            </div>
            <div *ngIf="client['account_type'] !== undefined" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Account Type:</span>
              <span class="text-sm text-text-primary">{{ client['account_type'] }}</span>
            </div>
            <div *ngIf="client['new_current_account']" class="flex justify-between py-2">
              <span class="text-sm font-medium text-text-secondary">New Current Account:</span>
              <span class="text-sm text-text-primary">{{ client['new_current_account'] }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Loan Status Section -->
      <div class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-4 border-b border-border-light">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-cyan-600 text-lg">trending_up</mat-icon>
            </div>
            <h3 class="text-lg font-semibold text-text-primary">Loan Status</h3>
          </div>
        </div>
        <div class="p-4">
          <div class="space-y-4">
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Current Loan Status:</span>
              <span class="px-3 py-1 text-xs rounded-full font-medium text-white"
                    [style.background-color]="getLoanStatusColor(getLoanStatus())">
                {{ getLoanStatus() | titlecase }}
              </span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Update Loan Status:</span>
              <div class="w-48">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Select Loan Status</mat-label>
                  <mat-select [(value)]="selectedLoanStatus" (selectionChange)="onLoanStatusChange($event)">
                    <mat-option value="soon">Soon</mat-option>
                    <mat-option value="processing">Processing</mat-option>
                    <mat-option value="approved">Approved</mat-option>
                    <mat-option value="hold">Hold</mat-option>
                    <mat-option value="rejected">Rejected</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div *ngIf="client.required_loan_amount" class="flex justify-between py-2 border-b border-gray-100">
              <span class="text-sm font-medium text-text-secondary">Required Loan Amount:</span>
              <span class="text-sm text-text-primary font-semibold">₹{{ client.required_loan_amount | number }}</span>
            </div>
            <div *ngIf="client.loan_purpose" class="flex justify-between py-2">
              <span class="text-sm font-medium text-text-secondary">Loan Purpose:</span>
              <span class="text-sm text-text-primary">{{ client.loan_purpose }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Documents Section -->
      <div *ngIf="hasDocuments()" class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-4 border-b border-border-light">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
              <mat-icon class="text-orange-600 text-lg">folder</mat-icon>
            </div>
            <h3 class="text-lg font-semibold text-text-primary">Documents</h3>
          </div>
        </div>
        <div class="p-4">
          <div class="space-y-3">
            <div *ngFor="let docType of getDocumentTypes()" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-sm transition-shadow">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                  <mat-icon class="text-blue-600 text-lg">{{ getDocumentIcon(docType) }}</mat-icon>
                </div>
                <span class="text-sm font-medium text-text-primary">{{ getDocumentName(docType) }}</span>
              </div>
              <div class="flex items-center gap-1">
                <button (click)="previewDocument(docType)" 
                        class="w-8 h-8 rounded-lg bg-blue-100 hover:bg-blue-200 flex items-center justify-center transition-colors"
                        [matTooltip]="'Preview ' + getDocumentName(docType)">
                  <mat-icon class="text-blue-600 text-sm">visibility</mat-icon>
                </button>
                <button (click)="downloadDocument(docType)" 
                        class="w-8 h-8 rounded-lg bg-green-100 hover:bg-green-200 flex items-center justify-center transition-colors"
                        [matTooltip]="'Download ' + getDocumentName(docType)">
                  <mat-icon class="text-green-600 text-sm">download</mat-icon>
                </button>
                <button *ngIf="hasDocument(docType)"
                        (click)="openInNewTab(docType)" 
                        class="w-8 h-8 rounded-lg bg-purple-100 hover:bg-purple-200 flex items-center justify-center transition-colors"
                        [matTooltip]="'Open ' + getDocumentName(docType) + ' in new tab'">
                  <mat-icon class="text-purple-600 text-sm">open_in_new</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Documents Message -->
      <div *ngIf="!hasDocuments()" class="bg-white rounded-xl shadow-sm border border-border-light overflow-hidden">
        <div class="p-8 text-center">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <mat-icon class="text-gray-400 text-2xl">folder_off</mat-icon>
          </div>
          <p class="text-text-muted">No documents have been uploaded for this client</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Dialog Actions -->
  <div mat-dialog-actions class="flex justify-end p-6 border-t border-gray-200 bg-gray-50">
    <button (click)="onClose()" 
            class="btn btn-primary px-6 py-2 flex items-center gap-2">
      <mat-icon class="text-sm">close</mat-icon>
      Close
    </button>
  </div>
</div>
